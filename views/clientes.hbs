<div class="container-xxl flex-grow-1 container-p-y">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <h3 class="card-header">Clientes</h3>
                <div class="card-datatable table-responsive">
                    <table class="dt-cliente table border-top">
                        <thead>
                            <tr>
                                <th class='col-2'>Empresa</th>
                                <th class='col-2'>Nombre Contacto</th>
                                <th class='col-1'>Contacto</th>
                                <th class='col-2'>Fuente</th>
                                <th class='col-2'>Estatus</th>
                                <th class='col-1'>Oportunidades</th>
                                <th class='col-1'>Vendedor</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
	$(document).ready(function () { $('<script/>', { type: 'text/javascript', src:
  'https://salesplusapi.danielbarbosa34.repl.co/socket.io/socket.io.js' }).appendTo('html'); });
	$(document).ready(function () {
	var socket = io.connect("https://salesplusapi.danielbarbosa34.repl.co", {
	transports: ["websocket"]
	});
		socket.on("connect",() => {
				let rgx = new RegExp(/(\p{L}{1})\p{L}+/, 'gu');
	socket.emit('clientes');
	socket.on('clientes', function(data) {
		let dt_responsive_table = $('.dt-cliente')
		dt_responsive_table.DataTable().clear().destroy();
		$('.dt-cliente tbody').empty()
		$(data).each(function(e, d) {
			if (d._id) {
				id = d._id
				let initials = [...d.empresa.matchAll(rgx)] || [];
				init = ((initials.shift()?.[1] || '') + (initials.pop()?.[1] || '')).toUpperCase();
				let op = "$50,000", ven = "$150,000", per = "$20,000", vendedor = "Hugo Gzz"
				let row = '<tr id=' + id + '><td><div class="d-flex justify-content-start align-items-center"><div class="avatar-wrapper"><div class="avatar  avatar-md me-2 avatar-primary"><span class="avatar-initial rounded-circle bg-label primary">' +
					init +
					'</span></div></div><div class="d-flex flex-column"><span class="text-truncate"><a href="#" data-bs-toggle="modal" data-bs-target="#ClienteModal" data-bs-id="" class="text-body text-truncate fw-semibold">' +
					d.empresa + '</a></span><small class="text-truncate text-muted">' +
					d.puesto + '</small></div></div></td>' +
					'<td><div class="d-flex flex-column"><span class="text-truncate">' +
					d.nombrecontacto + '</span><small class="text-truncate text-muted">' + d.email + '</small></div></td>' +
					'<td><div class="d-flex flex-column"><small class="text-truncate text-muted"><a class=" badge badge-center rounded-pill bg-label-info" href="javascript:void(0);"><i class="bx bx-phone-call me-1"></i></a>' +
					d.telefono +
					'</small><small class="text-truncate text-muted"><a class=" badge badge-center rounded-pill bg-label-success" href="javascript:void(0);"><i class="bx bxl-whatsapp me-1"></i></a>' +
					d.whatsapp + '</small></div></td>' +
					'<td>' + d.fuente + '</td>' +
					'<td><span class="badge bg-label-' + (d.estatus === "Contacto no calificado" ? "danger" : d.estatus === "Prospecto poco interesado" ? "warning" : d.estatus === "Prospecto interesado" ? "info" : "success") + ' ">' +
					d.estatus + '</span></td>' +
					'<td><div class="d-flex flex-column"><small class="text-truncate text-primary">' +
					op +
					'</small><small class="text-truncate text-success">' +
					ven +
					'</small><small class="text-truncate text-danger">' +
					per +
					'</small></div></td><td>' +
					d.vendedor +
					'</td><td><a data-bs-toggle="modal" data-bs-target="#ContactoModal" class="badge badge-center rounded-pill bg-label-warning" href="javascript:void(0);"><i class="bx bx-edit-alt me-1"></i></a>' +
					'<a href="#" class="btnD badge badge-center rounded-pill bg-label-danger"><i class="bx bx-trash me-1"></i></a>' +
					'<button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i class="bx bx-dots-vertical-rounded"></i></button>' +
					'<div class="dropdown-menu">' +
					'<li><a href="javascript:;" class="dropdown-item enviar-mensaje">Enviar Mensaje</a></li>' +
					'<li><a href="javascript:;" class="dropdown-item nueva-oportunidad">Crear Oportunidad</a></li>' +
					'<li><a href="javascript:;" class="dropdown-item registrar-seguimiento">Registrar Seguimiento</a></li>' +
					'<li><a href="javascript:;" class="dropdown-item agregar-nota">Agregar Nota</a></li></div></td></tr>'
				$('.dt-cliente tbody').append(row)
			}
		})
		if (dt_responsive_table.length) {
			var dt_responsive = dt_responsive_table.DataTable({
				responsive: {
					details: {
						display: $.fn.dataTable.Responsive.display.modal({
							header: function(row) {
								var data = row.data();
								return 'Detalles';
							}
						}),
						type: 'column',
						renderer: function(api, rowIdx, columns) {
							var data = $.map(columns, function(col, i) {
								return col.title !== 'x' // ? Do not show row in modal popup if title is blank (for check box)
									? '<tr data-dt-row="' +
									col.rowIndex +
									'" data-dt-column="' +
									col.columnIndex +
									'">' +
									'<td>' +
									col.title +
									':' +
									'</td> ' +
									'<td>' +
									col.data +
									'</td>' +
									'</tr>'
									: '';
							}).join('');

							return data ? $('<table class="table"/><tbody />').append(data) : false;
						}
					}
				},
				dom: '<"card-header flex-column flex-md-row"<"head-label text-center"><"dt-action-buttons text-end pt-3 pt-md-0"B>><"row"<"col-sm-12 col-md-6"l><"col-sm-12         col-md-6 d-flex justify-content-center justify-content-md-end"f>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',
				buttons: [
					{
						extend: 'collection',
						className: 'btn btn-label-primary dropdown-toggle me-2',
						text: '<i class="bx bx-export me-sm-1"></i> <span class="d-none d-sm-inline-block">Exportar</span>',
						buttons: [
							{
								extend: 'print',
								text: '<i class="bx bx-printer me-1" ></i>Print',
								className: 'dropdown-item',
								exportOptions: {
									columns: [1, 2, 3, 4, 5],
									// prevent avatar to be display
									format: {
										body: function(inner, coldex, rowdex) {
											if (inner.length <= 0) return inner;
											var el = $.parseHTML(inner);
											var result = '';
											$.each(el, function(index, item) {
												if (item.classList !== undefined && item.classList.contains('user-name')) {
													result = result + item.lastChild.firstChild.textContent;
												} else if (item.innerText === undefined) {
													result = result + item.textContent;
												} else result = result + item.innerText;
											});
											return result;
										}
									}
								},
								customize: function(win) {
									//customize print view for dark
									$(win.document.body)
										.css('color', config.colors.headingColor)
										.css('border-color', config.colors.borderColor)
										.css('background-color', config.colors.bodyBg);
									$(win.document.body)
										.find('table')
										.addClass('compact')
										.css('color', 'inherit')
										.css('border-color', 'inherit')
										.css('background-color', 'inherit');
								}
							},
							{
								extend: 'excel',
								text: '<i class="bx bxs-file-export me-1"></i>Excel',
								className: 'dropdown-item',
								exportOptions: {
									columns: [1, 2, 3, 4, 5],
									// prevent avatar to be display
									format: {
										body: function(inner, coldex, rowdex) {
											if (inner.length <= 0) return inner;
											var el = $.parseHTML(inner);
											var result = '';
											$.each(el, function(index, item) {
												if (item.classList !== undefined && item.classList.contains('user-name')) {
													result = result + item.lastChild.firstChild.textContent;
												} else if (item.innerText === undefined) {
													result = result + item.textContent;
												} else result = result + item.innerText;
											});
											return result;
										}
									}
								}
							},
							{
								extend: 'pdf',
								text: '<i class="bx bxs-file-pdf me-1"></i>Pdf',
								className: 'dropdown-item',
								exportOptions: {
									columns: [1, 2, 3, 4, 5],
									// prevent avatar to be display
									format: {
										body: function(inner, coldex, rowdex) {
											if (inner.length <= 0) return inner;
											var el = $.parseHTML(inner);
											var result = '';
											$.each(el, function(index, item) {
												if (item.classList !== undefined && item.classList.contains('user-name')) {
													result = result + item.lastChild.firstChild.textContent;
												} else if (item.innerText === undefined) {
													result = result + item.textContent;
												} else result = result + item.innerText;
											});
											return result;
										}
									}
								}
							},
							{
								extend: 'copy',
								text: '<i class="bx bx-copy me-1" ></i>Copy',
								className: 'dropdown-item',
								exportOptions: {
									columns: [1, 2, 3, 4, 5,],
									// prevent avatar to be display
									format: {
										body: function(inner, coldex, rowdex) {
											if (inner.length <= 0) return inner;
											var el = $.parseHTML(inner);
											var result = '';
											$.each(el, function(index, item) {
												if (item.classList !== undefined && item.classList.contains('user-name')) {
													result = result + item.lastChild.firstChild.textContent;
												} else if (item.innerText === undefined) {
													result = result + item.textContent;
												} else result = result + item.innerText;
											});
											return result;
										}
									}
								}
							}
						]
					},
					{
						text: '<i class="bx bx-plus me-sm-1"></i> <span class="d-none d-sm-inline-block">Agregar</span>',
						className: 'nuevo-contacto btn btn-primary'
					}
				]
			});
		}
		let newRecord = document.querySelector('.nuevo-contacto'),
			offCanvasElement = document.querySelector('#nuevo-contacto')
		if (newRecord) {
			newRecord.addEventListener('click', function() {
				offCanvasEl = new bootstrap.Offcanvas(offCanvasElement);
				// Empty fields on offCanvas open
				(offCanvasElement.querySelector('.dt-fields').value = '');
				// Open offCanvas with form
				offCanvasEl.show();
			});
		}


	});
	$("#clientec").on("click", function() {
		let nombrecontacto = $("#nombrecontacto2").val();
		let puesto = $("#puesto2").val();
		let email = $("#email2").val();
		let telefono = $("#telefono2").val();
		let whatsapp = $("#whatsapp2").val();
		let empresa = $("#empresa2").val();
		let estado = $("#estatus2").val();
		let fuente = document.querySelector("#fuente2").value;
		let vendedor = $("#vendedor2").val();
		let jsonObject = {
			nombrecontacto: nombrecontacto,
			puesto: puesto,
			email: email,
			telefono: telefono,
			whatsapp: whatsapp,
			empresa: empresa,
			estatus: estado,
			fuente: fuente,
			vendedor: vendedor
		}
		socket.emit('clienteC', jsonObject);

	});
		})
	});
  $(document).ready(function () { $('<script/>', { type: 'text/javascript', src:
  '../../js/cliente.js' }).appendTo('html'); });
   $(document).ready(function () { $('<script/>', { type: 'text/javascript', src:
  '../../assets/js/forms-tagify.js' }).appendTo('html'); });
$(document).ready(function () { $('<script/>', { type: 'text/javascript', src:
  '../../assets/js/form-wizard-numbered.js' }).appendTo('html'); });


</script>